#!/usr/bin/env sh

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
args=""

if [ $# -lt 1 ]; then
  $DIR/pretty.rb -h
  exit 1
fi

# find flags and profilenames
flags=()
profiles=""

while [[ $# -gt 0 ]]; do
  case $1 in
    -*) flags+="$1 "; shift ;;
    *) profiles+="${DIR}/../${1} "; shift ;;
  esac
done
set -- $flags

# parse flags
while getopts fqh opt; do
  case $opt in
    f)
      args+="-f " ;;
    q)
      args+="-q " ;;
    h)
      args+="-h "
      $DIR/pretty.rb -h
      exit 1 ;;
    \?)
      echo "Invalid argument $OPTARG"
      exit 1 ;;
  esac
done

inspec exec $profiles --reporter json | $DIR/pretty.rb $args
